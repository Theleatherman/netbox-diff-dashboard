<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>NetBox Snapshot</title>
  <link rel="stylesheet" href="/static/sentinex.css">
  <!-- DataTables -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <!--Logo etc.-->
  <div class="logo-row">
  <img src="{{ url_for('static', filename='sentinex-s-w.png') }}" alt="SENTINEX Logo" class="logo">
  <h1>Snapshot ‚Äì Stand vom {{ selected_date }}</h1>
  </div>
</head>
<body>
  <div class="container">
    <div class="filters">
    <label for="tag-filter">
        <span class="icon">üè∑Ô∏è</span>Tag:
    </label>
    <select id="tag-filter">
    <option value="">Alle</option>
    {% set all_tags = [] %}
    {% for _, _, _, tags in data %}
        {% for tag in tags %}
        {% if tag not in all_tags %}
            {% set _ = all_tags.append(tag) %}
        {% endif %}
        {% endfor %}
    {% endfor %}
    {% for tag in all_tags | sort %}
        <option value="{{ tag }}">{{ tag }}</option>
    {% endfor %}
    </select>

    <label for="datatable-search">
        <span class="icon"><i class="fas fa-search mr-2"></i></span>Suche:
    </label>
    <input type="search" id="datatable-search" placeholder="z.‚ÄØB. IP, Hostname..." />
    </div>

    <table id="iptable">
    <thead>
        <tr>
        <th><i class="fa-solid fa-circle-nodes"></i> IP</th>
        <th><i class="fa-solid fa-message"></i> Beschreibung</th>
        <th><i class="fa-solid fa-arrow-up-9-1"></i> DNS</th>
        <th><i class="fas fa-tags mr-2"></i>Tags</th>
        </tr>
    </thead>
    <tbody>
        {% for ip, desc, dns, tags in data %}
        <tr>
        <td>{{ ip }}</td>
        <td>{{ desc }}</td>
        <td>{{ dns }}</td>
        <td>
            {% for tag in tags %}
            <span class="tag">{{ tag }}</span>
            {% endfor %}
        </td>
        </tr>
        {% endfor %}
    </tbody>
    </table>
  </div>

  <!-- Scripts -->
<script>
  $(document).ready(function () {
    const table = $('#iptable').DataTable({
    pageLength: 25,
    dom: 'lrtip', // "l" = length, "r" = processing, "t" = table, "i" = info, "p" = pagination
    language: {
        search: "", // DataTables-Suche vollst√§ndig deaktivieren
        lengthMenu: "Zeige _MENU_ Eintr√§ge",
        info: "_START_ bis _END_ von _TOTAL_ Eintr√§gen",
        infoFiltered: "(gefiltert aus _MAX_ Gesamt)",
        infoEmpty: '<i class="fa-solid fa-xmark"></i> Keine Eintr√§ge verf√ºgbar',
        zeroRecords: '<i class="fa-solid fa-xmark"></i> Keine passenden Eintr√§ge gefunden',
        paginate: {
        next: '<i class="fa-solid fa-caret-right"></i>',
        previous: '<i class="fa-solid fa-caret-left"></i>'
        }
    }
    });

    // Externes Suchfeld verbinden
    $('#datatable-search').on('keyup', function () {
      table.search(this.value).draw();
    });

    // Dropdown-Filter
    $('#tag-filter').on('change', function () {
      const val = $(this).val();
      if (val) {
        table.column(3).search('\\b' + val + '\\b', true, false).draw(); // Tags = Spalte 3
      } else {
        table.column(3).search('').draw();
      }
    });
  });
</script>

</body>
  <footer>
    <div style="text-align: center; margin-top: 2em; font-size: 0.8em; color: #888;">
      <i class="fa-solid fa-screwdriver-wrench"></i> Made with ‚ù§Ô∏è ¬∑ <a href="https://git.avemo-it.cloud/theleatherman/">The Leatherman</a> ¬∑ &copy; {{ year }} <a href="https://www.sentinex.de/">sentinex GmbH</a>
    </div>
  </footer>
</html>
