{% extends "base.html" %}
{% block content %}

<div class="container mx-auto px-4 py-8">
  <h2 class="text-white text-xl font-bold mb-4"><i class="fa-solid fa-right-left mr-2"></i> DNS ‚Üî NetBox</h2>

  {% if error %}
    <div class="alert alert-danger text-white bg-red-600 p-2 mb-4 rounded">
      <strong>Fehler:</strong> {{ error }}
    </div>
  {% endif %}

  {% if cache_age %}
    <div class="text-sm text-gray-400 mb-4">
      DNS-Daten zuletzt aktualisiert am: {{ cache_age }}
    </div>
  {% endif %}

  <table id="dns-diff-table" class="display w-full text-sm">
    <thead>
      <tr>
        <th>IP</th>
        <th>Hostname (NetBox)</th>
        <th>Hostname (DNS)</th>
        <th>Abgleich</th>
      </tr>
    </thead>
    <tbody>
    {% for ip, hostname in diff.only_in_netbox.items() %}
        <tr>
        <td>{{ ip }}</td>
        <td>{{ hostname }}</td>
        <td></td>
        <td><span class="bg-blue-600 text-white text-xs font-semibold px-2 py-1 rounded">only NetBox</span></td>
        </tr>
    {% endfor %}

    {% for ip, hostname in diff.only_in_dns.items() %}
        <tr>
        <td>{{ ip }}</td>
        <td></td>
        <td>{{ hostname }}</td>
        <td><span class="bg-yellow-500 text-black text-xs font-semibold px-2 py-1 rounded">only DNS</span></td>
        </tr>
    {% endfor %}

    {% for mismatch in diff.hostname_mismatches %}
        <tr>
        <td>{{ mismatch[0] }}</td>
        <td>{{ mismatch[1] }}</td>
        <td>{{ mismatch[2] }}</td>
        <td><span class="bg-green-600 text-white text-xs font-semibold px-2 py-1 rounded">Synchron</span></td>
        </tr>
    {% endfor %}
    </tbody>
  </table>
</div>

<!-- DataTables + Buttons -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdn.datatables.net/plug-ins/1.13.6/sorting/ip-address.js"></script>

<script>
$('#dns-diff-table').DataTable({
  pageLength: 25,
  dom: 'Bfrtip',
  buttons: ['csv', 'excel'],
  columnDefs: [
    { type: 'ip-address', targets: 0 }  // Spalte 0 = IP
  ],
  language: {
    search: "üîç Suche:",
    paginate: { previous: "‚Üê", next: "‚Üí" },
    info: "Zeige _START_ bis _END_ von _TOTAL_ Eintr√§gen",
    zeroRecords: "Keine passenden Eintr√§ge gefunden",
    buttons: {
      csv: '<i class="fas fa-file-csv mr-2"></i> CSV',
      excel: '<i class="fas fa-file-excel mr-2"></i> Excel'
    }
  }
});
</script>

{% endblock %}
